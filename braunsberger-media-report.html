<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Squarespace Image Audit Report for <!-- DOMAIN_NAME --> </title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid #ccc; text-align: left; cursor: pointer; }
        th { background: #f5f5f5; }
        img { max-width: 120px; }
        .download-btn { cursor: pointer; color: blue; text-decoration: underline; }
        .sort-icon { margin-left: 5px; font-size: 0.8em; }
        .page-link { color: #007bff; text-decoration: none; }
        #toggle-thumbnails { margin-bottom: 15px; cursor: pointer; color: #007bff; text-decoration: underline; display: inline-block; }
    </style>
</head>
<body>
    <h1>Squarespace Image Audit Report for <!-- DOMAIN_NAME --></h1>

    <span id="toggle-thumbnails">Hide Thumbnails</span>

    <table id="audit-table">
        <thead>
            <tr>
                <th>Image</th>
                <th data-sort="width">Width<span class="sort-icon">↕</span></th>
                <th>Height</th>
                <th data-sort="size">Size<span class="sort-icon">↕</span></th>
                <th>Issues</th>
                <th>Pages Found On</th>
                <th>Download</th>
            </tr>
        </thead>
        <tbody>
            <!-- DATA_PLACEHOLDER -->
        </tbody>
    </table>

    <script>
        const auditData = <!-- AUDIT_JSON -->;
        const domain = "<!-- DOMAIN_NAME -->";

        const tbody = document.querySelector('#audit-table tbody');

        function renderTable(data) {
            tbody.innerHTML = '';
            data.forEach(img => {
                const pageLinks = img.pages.map(page => {
                    const path = new URL(page).pathname;
                    const label = path === '/' ? '/' : path;
                    return `<a href="${page}" class="page-link" target="_blank">${label}</a>`;
                }).join('; ');

                const sizeDisplay = img.size > 1024 * 1024
                    ? (img.size / (1024 * 1024)).toFixed(2) + ' MB'
                    : (img.size / 1024).toFixed(1) + ' KB';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${img.url}" loading="lazy" alt="preview"></td>
                    <td>${img.width}</td>
                    <td>${img.height}</td>
                    <td data-size-bytes="${img.size}">${sizeDisplay}</td>
                    <td>${img.issues.join('; ')}</td>
                    <td>${pageLinks}</td>
                    <td><span class="download-btn" onclick="downloadImage('${img.url}')">Download</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        renderTable(auditData);

        function downloadImage(url) {
            const a = document.createElement('a');
            a.href = url;
            a.download = url.split('/').pop();
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Toggle thumbnails visibility
        document.getElementById('toggle-thumbnails').addEventListener('click', function() {
            const imgs = document.querySelectorAll('#audit-table tbody img');
            imgs.forEach(img => {
                img.style.display = img.style.display === 'none' ? '' : 'none';
            });
            this.textContent = this.textContent === 'Hide Thumbnails' ? 'Show Thumbnails' : 'Hide Thumbnails';
        });

        // Column sorting logic with default first click = descending
        document.querySelectorAll('th[data-sort]').forEach(header => {
            let ascending = false;
            header.addEventListener('click', () => {
                const key = header.getAttribute('data-sort');
                if (key === 'size') {
                    auditData.sort((a, b) => ascending ? a.size - b.size : b.size - a.size);
                } else {
                    auditData.sort((a, b) => ascending ? a[key] - b[key] : b[key] - a[key]);
                }
                ascending = !ascending;
                header.querySelector('.sort-icon').textContent = ascending ? '▲' : '▼';
                renderTable(auditData);
            });
        });
    </script>
</body>
</html>